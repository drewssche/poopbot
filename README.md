# Poopbot

Poopbot — телеграм-бот для групповых чатов, который помогает вести ежедневный трекер «походов», не забывать про отметки и смотреть статистику без ручной рутины.

## Что умеет

- Каждый день публикует основной вопрос в заданное время чата.
- Под основным вопросом ведет счетчик по каждому участнику.
- Публикует уточняющие вопросы в той же сессии.
- В 22:00 отправляет напоминание тем, кто его включил.
- Автоматически закрывает сессию в конце дня.
- Отправляет итоги чата:
  - недели (в воскресенье в 23:00),
  - месяца (в последний день месяца в 23:00),
  - года (31 декабря в 23:00).
- В периодических итогах хвалит участников с активными стриками (с градацией по длине).
- Работает только в тех чатах, где его вызвали через `/start` (или `/help`/`/stats`).

## Команды

- `/start` — активировать бота в чате и показать актуальные вопросы.
- `/help` — меню помощи и настроек.
- `/stats` — интерактивная статистика: моя, чата и глобальная.

## Настройки

Внутри `/help` → `Настройки` можно:

- удалить себя полностью из базы;
- удалить себя только из текущего чата;
- выбрать время ежедневной публикации для текущего чата.

## Требования

- Docker
- Docker Compose

## Переменные окружения

Создай `.env` на основе `.env.example`:

```env
BOT_TOKEN=...
POSTGRES_DB=poopbot
POSTGRES_USER=postgres
POSTGRES_PASSWORD=postgres
POSTGRES_HOST=db
POSTGRES_PORT=5432
DATABASE_URL=postgresql+psycopg://postgres:postgres@db:5432/poopbot
```

## Запуск

```bash
docker compose up -d --build
```

## Логи

```bash
docker compose logs -f --tail=200 bot
```

Для PowerShell с фильтром:

```powershell
docker compose logs -f --tail=200 bot | Select-String -Pattern "ERROR|Traceback|Update id="
```

## Важно

- Миграции базы применяются автоматически при старте контейнера бота.
- Часовой пояс и время автопоста хранятся на уровне каждого чата.
- По умолчанию используется таймзона `Europe/Minsk`.
