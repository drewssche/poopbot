Poopbot
=======

Телеграм-бот для ежедневных вопросов Q1/Q2/Q3 в групповых чатах с учетом часовых поясов,
напоминаниями и автоматической статистикой по чату.

Возможности
-----------
- Ежедневный автопост Q1 в заданное время чата (по умолчанию 10:00, с учетом таймзоны).
- Q2 и Q3 создаются при появлении Q1 в текущей сессии.
- Ответы в Q2/Q3 принимаются только от пользователей с `poops_n > 0` в текущей сессии.
- Напоминание в 22:00 для подписанных пользователей (таймзона чата).
- Закрытие сессии в 23:55 по локальному времени; окно 23:55–00:05 — блокировка.
- Еженедельная (вс 23:00), ежемесячная (последний день 23:00), ежегодная (31 декабря 23:00) статистика чата.
- Бот отправляет сообщения только в чаты, где был вызван `/start` (или `/help`/`/stats`).

Команды
-------
- `/start` — создать запись чата и опубликовать текущий Q1 (и Q2/Q3 для сессии).
- `/help` — меню помощи и настройки.
- `/stats` — интерактивная статистика (моя/чат/глобальная) с выбором периода.

Требования
----------
- Docker + Docker Compose

Настройка
---------
Создай `.env` на основе `.env.example`:

```
BOT_TOKEN=...
POSTGRES_DB=poopbot
POSTGRES_USER=postgres
POSTGRES_PASSWORD=postgres
POSTGRES_HOST=db
POSTGRES_PORT=5432
DATABASE_URL=postgresql+psycopg://postgres:postgres@db:5432/poopbot
```

Запуск
------
Сборка и старт:

```
docker compose up -d --build
```

Логи:

```
docker compose logs -f --tail=200 bot
```

Примечания
----------
- Миграции Alembic выполняются автоматически при старте контейнера.
- Часовой пояс и время автопоста хранятся в таблице `chats`.
  Таймзона по умолчанию: `Europe/Minsk`.
